{% extends "base.html" %}

{% block title %}Customer Support - Nexus Digital Bank Australia{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3><i class="fas fa-headset me-2"></i>Customer Support</h3>
                <p class="mb-0">We're here to help you 24/7</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <i class="fas fa-phone fa-3x text-primary mb-3"></i>
                                <h5>Phone Support</h5>
                                <h4 class="text-primary">1800 NEXUS AU</h4>
                                <p class="text-muted">(1800 639 872)</p>
                                <p><strong>Available 24/7</strong></p>
                                <small>Average wait time: 2-3 minutes</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card bg-light mb-3">
                            <div class="card-body text-center">
                                <i class="fas fa-envelope fa-3x text-success mb-3"></i>
                                <h5>Email Support</h5>
                                <p><strong>support@nexusdigital.com.au</strong></p>
                                <p>Response time: 2-4 hours</p>
                                <button class="btn btn-outline-success" onclick="openEmailForm()">
                                    <i class="fas fa-envelope me-1"></i>Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <h5><i class="fas fa-comments me-2"></i>Live Chat Support</h5>
                <div class="card border-info">
                    <div class="card-body">
                        <div id="chatWindow" class="chat-window mb-3" style="height: 300px; overflow-y: auto; border: 1px solid #dee2e6; padding: 15px; background-color: #f8f9fa;">
                            <div class="chat-message support">
                                <div class="message-bubble support-bubble">
                                    <strong>Support Agent Sarah:</strong> Hello! Welcome to Nexus Digital Bank live chat. How can I assist you today?
                                </div>
                                <small class="text-muted">Just now</small>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatInput" placeholder="Type your message..." onkeypress="handleChatEnter(event)">
                            <button class="btn btn-primary" onclick="sendChatMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <div class="text-center mt-2">
                            <small class="text-muted">
                                <i class="fas fa-shield-alt me-1"></i>
                                This chat is secure and monitored for quality assurance
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5><i class="fas fa-exclamation-triangle me-2"></i>Emergency Contact</h5>
            </div>
            <div class="card-body">
                <p><strong>Lost/Stolen Cards:</strong></p>
                <h5 class="text-danger">1800 SECURE 1</h5>
                <p class="small">(1800 732 873)</p>
                
                <p><strong>Fraud Reporting:</strong></p>
                <h5 class="text-danger">1800 FRAUD 1</h5>
                <p class="small">(1800 372 831)</p>
                
                <div class="alert alert-danger alert-sm">
                    <i class="fas fa-phone me-1"></i>
                    <strong>Available 24/7</strong><br>
                    Call immediately if you suspect fraud
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-question-circle me-2"></i>Quick Help</h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                How do I reset my password?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                For security reasons, password resets must be done by calling customer service at 1800 NEXUS AU with your account information ready.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                Wire transfer limits?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Daily limit: AUD $50,000<br>
                                Monthly limit: AUD $250,000<br>
                                International limit: AUD $100,000<br>
                                Higher limits available upon request.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                International transfers?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                International transfers typically take 1-5 business days. SWIFT code required. Fee: AUD $45 per transfer.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5><i class="fas fa-map-marker-alt me-2"></i>Branch Locations</h5>
            </div>
            <div class="card-body">
                <p><strong>Headquarters:</strong></p>
                <p class="small">
                    Level 42, 120 Collins Street<br>
                    Melbourne, VIC 3000<br>
                    Mon-Fri: 9AM-5PM AEST
                </p>
                
                <p><strong>Find a Branch:</strong></p>
                <button class="btn btn-outline-info btn-sm w-100">
                    <i class="fas fa-search me-1"></i>Branch Locator
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let chatMessages = [
    {sender: 'support', text: 'Hello! Welcome to Nexus Digital Bank live chat. How can I assist you today?', time: 'Just now'}
];

function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (message === '') return;
    
    // Add user message
    addChatMessage('user', message);
    input.value = '';
    
    // Simulate typing indicator
    setTimeout(() => {
        addTypingIndicator();
        
        // Generate automatic response after delay
        setTimeout(() => {
            removeTypingIndicator();
            generateSupportResponse(message);
        }, 2000);
    }, 500);
}

function addChatMessage(sender, text) {
    const chatWindow = document.getElementById('chatWindow');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chat-message ' + sender;
    
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    messageDiv.innerHTML = `
        <div class="message-bubble ${sender}-bubble">
            ${sender === 'support' ? '<strong>Support Agent Sarah:</strong> ' : ''}${text}
        </div>
        <small class="text-muted">${timeStr}</small>
    `;
    
    chatWindow.appendChild(messageDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function addTypingIndicator() {
    const chatWindow = document.getElementById('chatWindow');
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'chat-message support';
    typingDiv.innerHTML = `
        <div class="message-bubble support-bubble">
            <em>Support Agent Sarah is typing...</em>
        </div>
    `;
    chatWindow.appendChild(typingDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function removeTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) {
        indicator.remove();
    }
}

function generateSupportResponse(userMessage) {
    const responses = [
        "I understand your concern. Let me help you with that right away.",
        "Thank you for contacting Nexus Digital Bank. I'm here to assist you.",
        "I can definitely help you with that. Let me look into your account details.",
        "That's a great question. For security purposes, I'll need to verify some information.",
        "I see what you're asking about. This is a common inquiry and I'm happy to explain.",
        "Let me connect you with our specialized department for the best assistance.",
        "I appreciate your patience. I'm reviewing the options available for your situation.",
        "That's an important matter. I want to make sure I give you the most accurate information."
    ];
    
    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
    addChatMessage('support', randomResponse);
    
    // Add a follow-up response
    setTimeout(() => {
        const followUps = [
            "Is there anything specific about your account you'd like me to review?",
            "Would you like me to transfer you to a specialist for further assistance?",
            "I can also send you detailed information via email if that would be helpful.",
            "For security verification, I may need to ask you some account details.",
            "Would you prefer to continue this conversation over the phone?"
        ];
        
        const followUp = followUps[Math.floor(Math.random() * followUps.length)];
        addChatMessage('support', followUp);
    }, 3000);
}

function handleChatEnter(event) {
    if (event.key === 'Enter') {
        sendChatMessage();
    }
}

function openEmailForm() {
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Send Email to Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Subject</label>
                            <select class="form-select">
                                <option>Account Inquiry</option>
                                <option>Wire Transfer Question</option>
                                <option>Statement Request</option>
                                <option>Technical Support</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message</label>
                            <textarea class="form-control" rows="4" placeholder="Please describe your inquiry..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="sendEmail()">Send Email</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const modalInstance = new bootstrap.Modal(modal);
    modalInstance.show();
    
    modal.addEventListener('hidden.bs.modal', function() {
        document.body.removeChild(modal);
    });
}

function sendEmail() {
    alert('Email sent successfully! You will receive a response within 2-4 hours.');
    bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
}
</script>

<style>
.chat-window {
    background-color: #f8f9fa;
}

.chat-message {
    margin-bottom: 15px;
}

.message-bubble {
    padding: 10px 15px;
    border-radius: 15px;
    max-width: 80%;
    word-wrap: break-word;
}

.support-bubble {
    background-color: #e3f2fd;
    margin-right: auto;
}

.user-bubble {
    background-color: #1976d2;
    color: white;
    margin-left: auto;
    text-align: right;
}

.user .message-bubble {
    margin-left: auto;
    margin-right: 0;
}

.support .message-bubble {
    margin-right: auto;
    margin-left: 0;
}

.alert-sm {
    padding: 0.5rem;
    font-size: 0.875rem;
}
</style>
{% endblock %}
