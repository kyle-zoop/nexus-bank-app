{% extends "base.html" %}

{% block title %}Wire Transfer Status - Nexus Digital Bank{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h3><i class="fas fa-hourglass-half me-2"></i>Wire Transfer - Compliance Hold</h3>
                <p class="mb-0">Your transfer is currently under regulatory review</p>
            </div>
            <div class="card-body">
                <!-- Status Timeline -->
                <div class="mb-4">
                    <h5><i class="fas fa-timeline me-2"></i>Transfer Status Timeline</h5>
                    <div class="timeline">
                        <div class="timeline-item completed">
                            <div class="timeline-marker bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="timeline-content">
                                <h6>Transfer Initiated</h6>
                                <p class="text-muted mb-0">Today, {{ moment().format('h:mm A') }}</p>
                            </div>
                        </div>
                        <div class="timeline-item completed">
                            <div class="timeline-marker bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="timeline-content">
                                <h6>Identity Verification Completed</h6>
                                <p class="text-muted mb-0">Today, {{ moment().add(15, 'minutes').format('h:mm A') }}</p>
                            </div>
                        </div>
                        <div class="timeline-item active">
                            <div class="timeline-marker bg-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="timeline-content">
                                <h6>Compliance Hold Applied</h6>
                                <p class="text-muted mb-0">Today, {{ moment().add(30, 'minutes').format('h:mm A') }}</p>
                                <div class="alert alert-warning mt-2">
                                    <strong>Reason:</strong> High-value international transfer requires enhanced due diligence review under BSA/AML regulations.
                                </div>
                            </div>
                        </div>
                        <div class="timeline-item pending">
                            <div class="timeline-marker bg-secondary">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="timeline-content">
                                <h6>Senior Compliance Review</h6>
                                <p class="text-muted mb-0">Estimated: {{ moment().add(2, 'days').format('MMM D, YYYY') }}</p>
                            </div>
                        </div>
                        <div class="timeline-item pending">
                            <div class="timeline-marker bg-secondary">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <div class="timeline-content">
                                <h6>Transfer Released</h6>
                                <p class="text-muted mb-0">Estimated: {{ moment().add(5, 'days').format('MMM D, YYYY') }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Details -->
                <div class="card bg-light mb-4">
                    <div class="card-body">
                        <h5><i class="fas fa-file-alt me-2"></i>Transfer Details</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Reference Number:</strong> WTR-{{ moment().format('YYYYMMDD') }}-{{ range(10000, 99999) | random }}</p>
                                <p><strong>Amount:</strong> ${{ request.args.get('amount', '0.00') }}</p>
                                <p><strong>Status:</strong> <span class="badge bg-warning">Compliance Hold</span></p>
                                <p><strong>Hold Reason:</strong> Enhanced Due Diligence Required</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Recipient:</strong> {{ request.args.get('recipient_name', 'N/A') }}</p>
                                <p><strong>Destination:</strong> {{ request.args.get('bank_country', 'N/A') }}</p>
                                <p><strong>Expected Release:</strong> {{ moment().add(5, 'days').format('MMM D, YYYY') }}</p>
                                <p><strong>Compliance Officer:</strong> Sarah Martinez (ID: CM-4471)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Required Actions -->
                <div class="card border-warning mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5><i class="fas fa-tasks me-2"></i>Additional Documentation Required</h5>
                    </div>
                    <div class="card-body">
                        <p>To expedite the review process, please provide the following additional documentation:</p>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Source of Funds Declaration (Form BSA-101)
                                <span class="badge bg-danger">Required</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Bank Statements (Last 90 days)
                                <span class="badge bg-danger">Required</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Purpose of Transfer Affidavit
                                <span class="badge bg-warning">Recommended</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Recipient Verification Letter
                                <span class="badge bg-warning">Recommended</span>
                            </li>
                        </ul>
                        
                        <div class="mt-3">
                            <button class="btn btn-warning" onclick="requestCallback()">
                                <i class="fas fa-phone me-1"></i>Request Compliance Callback
                            </button>
                            <button class="btn btn-outline-primary" onclick="uploadDocuments()">
                                <i class="fas fa-upload me-1"></i>Upload Documents
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hold Information -->
                <div class="card bg-info text-white mb-4">
                    <div class="card-body">
                        <h6><i class="fas fa-info-circle me-2"></i>About Compliance Holds</h6>
                        <p class="mb-2">Wire transfer holds are applied when:</p>
                        <ul class="mb-2">
                            <li>Transfer amount exceeds $5,000</li>
                            <li>Destination country is high-risk for money laundering</li>
                            <li>Unusual transfer patterns are detected</li>
                            <li>Required compliance documentation is incomplete</li>
                        </ul>
                        <p class="mb-0"><small>These holds are mandated by federal regulations including the Bank Secrecy Act and USA PATRIOT Act.</small></p>
                    </div>
                </div>

                <!-- Contact Options -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body text-center">
                                <i class="fas fa-phone fa-2x text-primary mb-2"></i>
                                <h6>Compliance Hotline</h6>
                                <p class="text-muted">1-800-NEXUS-1 (Option 4)</p>
                                <p><small>Available 24/7 for compliance inquiries</small></p>
                                <button class="btn btn-primary btn-sm" onclick="callCompliance()">
                                    <i class="fas fa-phone me-1"></i>Call Now
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body text-center">
                                <i class="fas fa-envelope fa-2x text-primary mb-2"></i>
                                <h6>Email Support</h6>
                                <p class="text-muted">compliance@nexusdigitalbank.com</p>
                                <p><small>Response within 2-4 business hours</small></p>
                                <button class="btn btn-outline-primary btn-sm" onclick="emailCompliance()">
                                    <i class="fas fa-envelope me-1"></i>Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-4 d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary me-md-2">
                        <i class="fas fa-home me-1"></i>Return to Dashboard
                    </a>
                    <button class="btn btn-primary" onclick="trackTransfer()">
                        <i class="fas fa-search me-1"></i>Track Transfer Status
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 15px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #dee2e6;
}

.timeline-item {
    position: relative;
    padding-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -22.5px;
    top: 0;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
}

.timeline-content {
    margin-left: 15px;
}

.timeline-item.completed .timeline-marker {
    background-color: #28a745 !important;
}

.timeline-item.active .timeline-marker {
    background-color: #ffc107 !important;
    color: #000;
}

.timeline-item.pending .timeline-marker {
    background-color: #6c757d !important;
}
</style>

<script>
function requestCallback() {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Scheduling...';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        showAlert('Compliance callback scheduled. Officer Sarah Martinez will contact you within 2-4 business hours at your registered phone number.', 'success');
    }, 3000);
}

function uploadDocuments() {
    showAlert('Document upload portal is temporarily under maintenance. Please email documents to compliance@nexusdigitalbank.com or call the compliance hotline.', 'warning');
}

function callCompliance() {
    showAlert('Please have your transfer reference number (WTR-{{ moment().format("YYYYMMDD") }}-{{ range(10000, 99999) | random }}) ready when calling.', 'info');
}

function emailCompliance() {
    const subject = 'Wire Transfer Hold Inquiry - WTR-{{ moment().format("YYYYMMDD") }}-{{ range(10000, 99999) | random }}';
    const body = 'Dear Compliance Team,%0D%0A%0D%0AI am writing regarding my wire transfer that is currently under compliance hold.%0D%0A%0D%0AReference Number: WTR-{{ moment().format("YYYYMMDD") }}-{{ range(10000, 99999) | random }}%0D%0AAmount: ${{ request.args.get("amount", "0.00") }}%0D%0A%0D%0APlease advise on the status and any additional documentation required.%0D%0A%0D%0AThank you for your assistance.';
    
    window.location.href = `mailto:compliance@nexusdigitalbank.com?subject=${subject}&body=${body}`;
}

function trackTransfer() {
    showAlert('Transfer tracking system is currently being updated. Please call the compliance hotline for real-time status updates.', 'info');
}

function showAlert(message, type) {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} alert-dismissible fade show`;
    alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.col-lg-8');
    container.insertBefore(alert, container.firstChild);
    
    setTimeout(() => {
        if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
        }
    }, 8000);
}

// Show initial status update
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        showAlert('Your transfer has been flagged for enhanced due diligence review. This is a standard procedure for high-value international transfers.', 'warning');
    }, 2000);
});
</script>
{% endblock %}
